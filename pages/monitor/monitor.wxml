<!-- pages/monitor/monitor.wxml -->
<view class="container">
  <!-- é¡¶éƒ¨çŠ¶æ€æ  -->
  <view class="status-bar">
    <view class="drone-status {{droneStatus.online ? 'online' : 'offline'}}">
      <text>æ— äººæœºçŠ¶æ€: {{droneStatus.online ? 'åœ¨çº¿' : 'ç¦»çº¿'}}</text>
      <text wx:if="{{droneStatus.online}}">ç”µé‡: {{droneStatus.battery}}%</text>
    </view>
    <view class="weather-info">
      <text>{{weather.temperature}}Â°C</text>
      <text>{{weather.windSpeed}}m/s</text>
    </view>
  </view>
  
  <!-- åœ°å›¾åŒºåŸŸ -->
  <view class="map-container">
    <map id="droneMap"
      longitude="{{mapCenter.longitude}}"
      latitude="{{mapCenter.latitude}}"
      scale="{{mapScale}}"
      markers="{{markers}}"
      polyline="{{polylines}}"
      show-location
      enable-3D="{{true}}"
      enable-overlooking="{{true}}"
      enable-rotate="{{true}}"
      bindregionchange="onMapRegionChange"
      bindtap="onMapTap">
    </map>
    
    <!-- åœ°å›¾æ§åˆ¶æŒ‰é’® -->
    <view class="map-controls">
      <view class="control-btn" bindtap="zoomIn">
        <text class="icon">+</text>
      </view>
      <view class="control-btn" bindtap="zoomOut">
        <text class="icon">-</text>
      </view>
      <view class="control-btn" bindtap="resetMapView">
        <text class="icon">âŸ³</text>
      </view>
      <view class="control-btn" bindtap="toggleMapType">
        <text class="icon">ğŸ—ºï¸</text>
      </view>
    </view>
  </view>
  
  <!-- è§†é¢‘æµåŒºåŸŸ -->
  <view class="video-container">
    <view class="video-header">
      <text class="title">å®æ—¶ç›‘æ§</text>
      <view class="video-controls">
        <view class="control-btn {{isFullscreen ? 'active' : ''}}" bindtap="toggleFullscreen">
          <text class="icon">â›¶</text>
        </view>
        <view class="control-btn {{isRecording ? 'active' : ''}}" bindtap="toggleRecording">
          <text class="icon">âº</text>
        </view>
        <view class="control-btn {{isAiEnabled ? 'active' : ''}}" bindtap="toggleAiDetection">
          <text class="icon">AI</text>
        </view>
      </view>
    </view>
    
    <view class="video-player {{isFullscreen ? 'fullscreen' : ''}}">
      <live-player 
        id="videoPlayer"
        src="{{currentVideoUrl}}"
        mode="RTC"
        autoplay="{{true}}"
        muted="{{isMuted}}"
        object-fit="{{objectFit}}"
        min-cache="1"
        max-cache="3"
        bindstatechange="onPlayerStateChange"
        binderror="onPlayerError">
        
        <!-- AIæ£€æµ‹ç»“æœå åŠ å±‚ -->
        <cover-view class="detection-overlay" wx:if="{{isAiEnabled && detections.length > 0}}">
          <block wx:for="{{detections}}" wx:key="id">
            <cover-view class="detection-box {{item.class}}" style="left: {{item.x}}%; top: {{item.y}}%; width: {{item.width}}%; height: {{item.height}}%;">
              <cover-view class="detection-label">
                {{item.class}} {{item.confidence}}%
              </cover-view>
            </cover-view>
          </block>
        </cover-view>
        
        <!-- è§†é¢‘ä¿¡æ¯å åŠ å±‚ -->
        <cover-view class="video-info">
          <cover-view class="info-item">
            <cover-view>æ— äººæœºID: {{currentDrone.id}}</cover-view>
            <cover-view>é«˜åº¦: {{currentDrone.altitude}}m</cover-view>
            <cover-view>é€Ÿåº¦: {{currentDrone.speed}}km/h</cover-view>
          </cover-view>
          <cover-view class="info-item time">
            {{currentTime}}
          </cover-view>
        </cover-view>
      </live-player>
    </view>
    
    <!-- å¤šç”»é¢é€‰æ‹©å™¨ -->
    <scroll-view class="video-selector" scroll-x="{{true}}">
      <view 
        wx:for="{{droneList}}" 
        wx:key="id"
        class="video-item {{currentDrone.id === item.id ? 'active' : ''}}"
        bindtap="switchDrone"
        data-id="{{item.id}}">
        <image src="{{item.thumbnail}}" mode="aspectFill"></image>
        <view class="video-item-info">
          <text>{{item.name}}</text>
          <text class="{{item.online ? 'online' : 'offline'}}">{{item.online ? 'åœ¨çº¿' : 'ç¦»çº¿'}}</text>
        </view>
      </view>
    </scroll-view>
  </view>
  
  <!-- åº•éƒ¨æ§åˆ¶æ  -->
  <view class="control-panel">
    <view class="panel-item" bindtap="showDroneDetails">
      <text class="icon">ğŸ“Š</text>
      <text>è¯¦æƒ…</text>
    </view>
    <view class="panel-item" bindtap="takeScreenshot">
      <text class="icon">ğŸ“·</text>
      <text>æˆªå›¾</text>
    </view>
    <view class="panel-item" bindtap="showWarnings">
      <text class="icon">âš ï¸</text>
      <text>é¢„è­¦</text>
      <view class="badge" wx:if="{{unreadWarnings > 0}}">{{unreadWarnings}}</view>
    </view>
    <view class="panel-item" bindtap="showSettings">
      <text class="icon">âš™ï¸</text>
      <text>è®¾ç½®</text>
    </view>
  </view>
</view> 