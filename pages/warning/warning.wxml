<!-- pages/warning/warning.wxml -->
<view class="container">
  <!-- é¡¶éƒ¨æ ‡ç­¾é¡µ -->
  <view class="tabs">
    <view class="tab {{activeTab === 'all' ? 'active' : ''}}" bindtap="switchTab" data-tab="all">
      <text>å…¨éƒ¨</text>
      <view class="badge" wx:if="{{statistics.all > 0}}">{{statistics.all}}</view>
    </view>
    <view class="tab {{activeTab === 'fire' ? 'active' : ''}}" bindtap="switchTab" data-tab="fire">
      <text>ç«æƒ…</text>
      <view class="badge" wx:if="{{statistics.fire > 0}}">{{statistics.fire}}</view>
    </view>
    <view class="tab {{activeTab === 'landslide' ? 'active' : ''}}" bindtap="switchTab" data-tab="landslide">
      <text>æ³¥çŸ³æµ</text>
      <view class="badge" wx:if="{{statistics.landslide > 0}}">{{statistics.landslide}}</view>
    </view>
    <view class="tab {{activeTab === 'animal' ? 'active' : ''}}" bindtap="switchTab" data-tab="animal">
      <text>åŠ¨ç‰©å¼‚å¸¸</text>
      <view class="badge" wx:if="{{statistics.animal > 0}}">{{statistics.animal}}</view>
    </view>
  </view>
  
  <!-- ç­›é€‰æ  -->
  <view class="filter-bar">
    <view class="filter-item" bindtap="toggleTimeFilter">
      <text>æ—¶é—´: {{timeFilter}}</text>
      <text class="arrow">â–¼</text>
    </view>
    <view class="filter-item" bindtap="toggleLevelFilter">
      <text>çº§åˆ«: {{levelFilter}}</text>
      <text class="arrow">â–¼</text>
    </view>
    <view class="filter-item" bindtap="toggleStatusFilter">
      <text>çŠ¶æ€: {{statusFilter}}</text>
      <text class="arrow">â–¼</text>
    </view>
    <view class="search-box">
      <input type="text" placeholder="æœç´¢é¢„è­¦ä¿¡æ¯" bindinput="onSearchInput" value="{{searchKeyword}}" />
      <text class="search-icon">ğŸ”</text>
    </view>
  </view>
  
  <!-- æ—¶é—´ç­›é€‰ä¸‹æ‹‰èœå• -->
  <view class="dropdown-menu" wx:if="{{showTimeFilter}}">
    <view class="dropdown-item {{timeFilter === 'å…¨éƒ¨' ? 'active' : ''}}" bindtap="selectTimeFilter" data-value="å…¨éƒ¨">å…¨éƒ¨</view>
    <view class="dropdown-item {{timeFilter === 'ä»Šå¤©' ? 'active' : ''}}" bindtap="selectTimeFilter" data-value="ä»Šå¤©">ä»Šå¤©</view>
    <view class="dropdown-item {{timeFilter === 'æ˜¨å¤©' ? 'active' : ''}}" bindtap="selectTimeFilter" data-value="æ˜¨å¤©">æ˜¨å¤©</view>
    <view class="dropdown-item {{timeFilter === 'è¿‘7å¤©' ? 'active' : ''}}" bindtap="selectTimeFilter" data-value="è¿‘7å¤©">è¿‘7å¤©</view>
    <view class="dropdown-item {{timeFilter === 'è¿‘30å¤©' ? 'active' : ''}}" bindtap="selectTimeFilter" data-value="è¿‘30å¤©">è¿‘30å¤©</view>
  </view>
  
  <!-- çº§åˆ«ç­›é€‰ä¸‹æ‹‰èœå• -->
  <view class="dropdown-menu" wx:if="{{showLevelFilter}}">
    <view class="dropdown-item {{levelFilter === 'å…¨éƒ¨' ? 'active' : ''}}" bindtap="selectLevelFilter" data-value="å…¨éƒ¨">å…¨éƒ¨</view>
    <view class="dropdown-item {{levelFilter === 'é«˜' ? 'active' : ''}}" bindtap="selectLevelFilter" data-value="é«˜">é«˜</view>
    <view class="dropdown-item {{levelFilter === 'ä¸­' ? 'active' : ''}}" bindtap="selectLevelFilter" data-value="ä¸­">ä¸­</view>
    <view class="dropdown-item {{levelFilter === 'ä½' ? 'active' : ''}}" bindtap="selectLevelFilter" data-value="ä½">ä½</view>
  </view>
  
  <!-- çŠ¶æ€ç­›é€‰ä¸‹æ‹‰èœå• -->
  <view class="dropdown-menu" wx:if="{{showStatusFilter}}">
    <view class="dropdown-item {{statusFilter === 'å…¨éƒ¨' ? 'active' : ''}}" bindtap="selectStatusFilter" data-value="å…¨éƒ¨">å…¨éƒ¨</view>
    <view class="dropdown-item {{statusFilter === 'æœªå¤„ç†' ? 'active' : ''}}" bindtap="selectStatusFilter" data-value="æœªå¤„ç†">æœªå¤„ç†</view>
    <view class="dropdown-item {{statusFilter === 'å¤„ç†ä¸­' ? 'active' : ''}}" bindtap="selectStatusFilter" data-value="å¤„ç†ä¸­">å¤„ç†ä¸­</view>
    <view class="dropdown-item {{statusFilter === 'å·²å¤„ç†' ? 'active' : ''}}" bindtap="selectStatusFilter" data-value="å·²å¤„ç†">å·²å¤„ç†</view>
  </view>
  
  <!-- é¢„è­¦åˆ—è¡¨ -->
  <scroll-view class="warning-list" scroll-y="{{true}}" bindscrolltolower="loadMore">
    <view wx:if="{{filteredWarnings.length === 0}}" class="empty-list">
      <image src="/assets/icons/empty.png" mode="aspectFit"></image>
      <text>æš‚æ— é¢„è­¦ä¿¡æ¯</text>
    </view>
    
    <view wx:for="{{filteredWarnings}}" wx:key="id" class="warning-item" bindtap="navigateToDetail" data-id="{{item.id}}">
      <view class="warning-header">
        <view class="warning-type {{item.type}}">{{item.typeText}}</view>
        <view class="warning-level {{item.level}}">{{item.levelText}}</view>
        <view class="warning-status {{item.status}}">{{item.statusText}}</view>
      </view>
      
      <view class="warning-content">
        <view class="warning-title">{{item.title}}</view>
        <view class="warning-desc">{{item.description}}</view>
        <view class="warning-location">
          <text class="icon">ğŸ“</text>
          <text>{{item.location}}</text>
        </view>
      </view>
      
      <view class="warning-footer">
        <view class="warning-time">
          <text class="icon">ğŸ•’</text>
          <text>{{item.time}}</text>
        </view>
        <view class="warning-drone">
          <text class="icon">ğŸš</text>
          <text>{{item.droneName}}</text>
        </view>
      </view>
      
      <view class="warning-actions">
        <view class="action-btn view" catchtap="viewWarningOnMap" data-id="{{item.id}}">
          <text class="icon">ğŸ—ºï¸</text>
          <text>æŸ¥çœ‹åœ°å›¾</text>
        </view>
        <view class="action-btn share" catchtap="shareWarning" data-id="{{item.id}}">
          <text class="icon">ğŸ“¤</text>
          <text>åˆ†äº«</text>
        </view>
        <view class="action-btn {{item.status === 'pending' ? 'process' : 'processed'}}" catchtap="toggleWarningStatus" data-id="{{item.id}}" data-status="{{item.status}}">
          <text class="icon">{{item.status === 'pending' ? 'âœ…' : 'â†©ï¸'}}</text>
          <text>{{item.status === 'pending' ? 'æ ‡è®°å¤„ç†' : 'é‡ç½®çŠ¶æ€'}}</text>
        </view>
      </view>
    </view>
    
    <view wx:if="{{isLoading}}" class="loading">
      <view class="loading-spinner"></view>
      <text>åŠ è½½ä¸­...</text>
    </view>
    
    <view wx:if="{{!isLoading && !hasMore && filteredWarnings.length > 0}}" class="no-more">
      <text>æ²¡æœ‰æ›´å¤šæ•°æ®äº†</text>
    </view>
  </scroll-view>
  
  <!-- æ‚¬æµ®æŒ‰é’® -->
  <view class="float-btns">
    <view class="float-btn model-btn" bindtap="toggleModelInfo">
      <text class="icon">ğŸ¤–</text>
      <text>AIæ¨¡å‹</text>
    </view>
    
    <view class="float-btn" bindtap="navigateToHeatmap">
      <text class="icon">ğŸ”¥</text>
      <text>çƒ­åŠ›å›¾</text>
    </view>
  </view>
</view>

<!-- æ¨¡å‹ä¿¡æ¯é¢æ¿ -->
<view class="model-panel {{showModelInfo ? 'show' : ''}}">
  <view class="model-header">
    <text>AI æ£€æµ‹æ¨¡å‹ä¿¡æ¯</text>
    <view class="close-btn" bindtap="toggleModelInfo">Ã—</view>
  </view>
  
  <view class="model-content">
    <view class="model-info-item">
      <text class="label">æ¨¡å‹åç§°</text>
      <text class="value">{{modelInfo.name}}</text>
    </view>
    
    <view class="model-info-item">
      <text class="label">ç‰ˆæœ¬</text>
      <text class="value">{{modelInfo.version}}</text>
    </view>
    
    <view class="model-info-item">
      <text class="label">æœ€åæ›´æ–°</text>
      <text class="value">{{modelInfo.lastUpdated}}</text>
    </view>
    
    <view class="model-info-item">
      <text class="label">ç½®ä¿¡åº¦é˜ˆå€¼</text>
      <view class="confidence-slider">
        <slider 
          min="50" 
          max="95" 
          step="5" 
          value="{{modelInfo.confidence * 100}}" 
          activeColor="var(--primary-color)"
          backgroundColor="#e9e9e9"
          blockSize="24"
          bindchange="updateConfidence"
        />
        <text class="confidence-value">{{modelInfo.confidence * 100}}%</text>
      </view>
    </view>
    
    <view class="detection-classes">
      <text class="section-title">æ£€æµ‹ç±»åˆ«</text>
      <view class="classes-list">
        <view class="class-item" wx:for="{{detectionClasses}}" wx:key="id">
          <view class="class-color" style="background-color: {{item.color}}"></view>
          <text class="class-name">{{item.name}}</text>
          <text class="class-count">{{item.count}}</text>
        </view>
      </view>
    </view>
    
    <view class="model-tips">
      <text class="section-title">æç¤º</text>
      <text class="tip-text">æé«˜ç½®ä¿¡åº¦é˜ˆå€¼å¯å‡å°‘è¯¯æŠ¥ï¼Œä½†å¯èƒ½ä¼šæ¼æ£€éƒ¨åˆ†ç›®æ ‡ã€‚</text>
      <text class="tip-text">å»ºè®®åœ¨70%-85%ä¹‹é—´è®¾ç½®ä»¥è·å¾—æœ€ä½³æ•ˆæœã€‚</text>
    </view>
  </view>
</view> 